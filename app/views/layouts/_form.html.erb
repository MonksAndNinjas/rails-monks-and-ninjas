<%= form_for user do |f| %>

  <%= f.fields_for :nested_attributes do |attr| %>
    <% nested_attributes.attr_keys.each do |key| %>

      <% data_type = nested_attributes.get_data_type_for(key) %>
<!-- find data type then create label and field -->
      <%= attr.label "#{key.to_s}" unless invalid_label?(key)  %><br>
      <%= display_field_using(key, data_type, attr) %><br>

    <% end %>
  <% end %>

  <br></br>

  <%= f.password_field :password, placeholder: "password" %>

  <%= f.submit "Create", class: "button" %>
<% end %>
